(()=>{"use strict";const W=Symbol("Comlink.proxy"),st=Symbol("Comlink.endpoint"),it=Symbol("Comlink.releaseProxy"),P=Symbol("Comlink.thrown"),F=e=>"object"==typeof e&&null!==e||"function"==typeof e,H=new Map([["proxy",{canHandle:e=>F(e)&&e[W],serialize(e){const{port1:r,port2:t}=new MessageChannel;return A(e,r),[t,[t]]},deserialize:e=>(e.start(),function(e,r){return M(e,[],void 0)}(e))}],["throw",{canHandle:e=>F(e)&&P in e,serialize({value:e}){let r;return r=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[r,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}}]]);function A(e,r=self){r.addEventListener("message",function t(n){if(!n||!n.data)return;const{id:i,type:s,path:o}=Object.assign({path:[]},n.data),c=(n.data.argumentList||[]).map(b);let u;try{const a=o.slice(0,-1).reduce((f,h)=>f[h],e),l=o.reduce((f,h)=>f[h],e);switch(s){case"GET":u=l;break;case"SET":a[o.slice(-1)[0]]=b(n.data.value),u=!0;break;case"APPLY":u=l.apply(a,c);break;case"CONSTRUCT":u=function(e){return Object.assign(e,{[W]:!0})}(new l(...c));break;case"ENDPOINT":{const{port1:f,port2:h}=new MessageChannel;A(e,h),u=function(e,r){return N.set(e,r),e}(f,[f])}break;case"RELEASE":u=void 0;break;default:return}}catch(a){u={value:a,[P]:0}}Promise.resolve(u).catch(a=>({value:a,[P]:0})).then(a=>{const[l,f]=T(a);r.postMessage(Object.assign(Object.assign({},l),{id:i}),f),"RELEASE"===s&&(r.removeEventListener("message",t),D(r))})}),r.start&&r.start()}function D(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function w(e){if(e)throw new Error("Proxy has been released and is not useable")}function M(e,r=[],t=function(){}){let n=!1;const i=new Proxy(t,{get(s,o){if(w(n),o===it)return()=>g(e,{type:"RELEASE",path:r.map(c=>c.toString())}).then(()=>{D(e),n=!0});if("then"===o){if(0===r.length)return{then:()=>i};const c=g(e,{type:"GET",path:r.map(u=>u.toString())}).then(b);return c.then.bind(c)}return M(e,[...r,o])},set(s,o,c){w(n);const[u,a]=T(c);return g(e,{type:"SET",path:[...r,o].map(l=>l.toString()),value:u},a).then(b)},apply(s,o,c){w(n);const u=r[r.length-1];if(u===st)return g(e,{type:"ENDPOINT"}).then(b);if("bind"===u)return M(e,r.slice(0,-1));const[a,l]=z(c);return g(e,{type:"APPLY",path:r.map(f=>f.toString()),argumentList:a},l).then(b)},construct(s,o){w(n);const[c,u]=z(o);return g(e,{type:"CONSTRUCT",path:r.map(a=>a.toString()),argumentList:c},u).then(b)}});return i}function lt(e){return Array.prototype.concat.apply([],e)}function z(e){const r=e.map(T);return[r.map(t=>t[0]),lt(r.map(t=>t[1]))]}const N=new WeakMap;function T(e){for(const[r,t]of H)if(t.canHandle(e)){const[n,i]=t.serialize(e);return[{type:"HANDLER",name:r,value:n},i]}return[{type:"RAW",value:e},N.get(e)||[]]}function b(e){switch(e.type){case"HANDLER":return H.get(e.name).deserialize(e.value);case"RAW":return e.value}}function g(e,r,t){return new Promise(n=>{const i=new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");e.addEventListener("message",function s(o){!o.data||!o.data.id||o.data.id!==i||(e.removeEventListener("message",s),n(o.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:i},r),t)})}function j(e,r,t,n){return new(t||(t=Promise))(function(s,o){function c(l){try{a(n.next(l))}catch(f){o(f)}}function u(l){try{a(n.throw(l))}catch(f){o(f)}}function a(l){l.done?s(l.value):function(s){return s instanceof t?s:new t(function(o){o(s)})}(l.value).then(c,u)}a((n=n.apply(e,r||[])).next())})}function d(e){return"function"==typeof e}function q(e){const t=e(n=>{Error.call(n),n.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const R=q(e=>function(t){e(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((n,i)=>`${i+1}) ${n.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function I(e,r){if(e){const t=e.indexOf(r);0<=t&&e.splice(t,1)}}class p{constructor(r){this.initialTeardown=r,this.closed=!1,this._parentage=null,this._teardowns=null}unsubscribe(){let r;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const s of t)s.remove(this);else t.remove(this);const{initialTeardown:n}=this;if(d(n))try{n()}catch(s){r=s instanceof R?s.errors:[s]}const{_teardowns:i}=this;if(i){this._teardowns=null;for(const s of i)try{X(s)}catch(o){r=null!=r?r:[],o instanceof R?r=[...r,...o.errors]:r.push(o)}}if(r)throw new R(r)}}add(r){var t;if(r&&r!==this)if(this.closed)X(r);else{if(r instanceof p){if(r.closed||r._hasParent(this))return;r._addParent(this)}(this._teardowns=null!==(t=this._teardowns)&&void 0!==t?t:[]).push(r)}}_hasParent(r){const{_parentage:t}=this;return t===r||Array.isArray(t)&&t.includes(r)}_addParent(r){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(r),t):t?[t,r]:r}_removeParent(r){const{_parentage:t}=this;t===r?this._parentage=null:Array.isArray(t)&&I(t,r)}remove(r){const{_teardowns:t}=this;t&&I(t,r),r instanceof p&&r._removeParent(this)}}p.EMPTY=(()=>{const e=new p;return e.closed=!0,e})();const $=p.EMPTY;function B(e){return e instanceof p||e&&"closed"in e&&d(e.remove)&&d(e.add)&&d(e.unsubscribe)}function X(e){d(e)?e():e.unsubscribe()}const m={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},S={setTimeout(...e){const{delegate:r}=S;return((null==r?void 0:r.setTimeout)||setTimeout)(...e)},clearTimeout(e){const{delegate:r}=S;return((null==r?void 0:r.clearTimeout)||clearTimeout)(e)},delegate:void 0};function E(){}const yt=V("C",void 0,void 0);function V(e,r,t){return{kind:e,value:r,error:t}}let y=null;function x(e){if(m.useDeprecatedSynchronousErrorHandling){const r=!y;if(r&&(y={errorThrown:!1,error:null}),e(),r){const{errorThrown:t,error:n}=y;if(y=null,t)throw n}}else e()}class J extends p{constructor(r){super(),this.isStopped=!1,r?(this.destination=r,B(r)&&r.add(this)):this.destination=vt}static create(r,t,n){return new K(r,t,n)}next(r){this.isStopped?k(V("N",r,void 0),this):this._next(r)}error(r){this.isStopped?k(V("E",void 0,r),this):(this.isStopped=!0,this._error(r))}complete(){this.isStopped?k(yt,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(r){this.destination.next(r)}_error(r){try{this.destination.error(r)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}class K extends J{constructor(r,t,n){let i;if(super(),d(r))i=r;else if(r){let s;({next:i,error:t,complete:n}=r),this&&m.useDeprecatedNextContext?(s=Object.create(r),s.unsubscribe=()=>this.unsubscribe()):s=r,i=null==i?void 0:i.bind(s),t=null==t?void 0:t.bind(s),n=null==n?void 0:n.bind(s)}this.destination={next:i?L(i):E,error:L(null!=t?t:Q),complete:n?L(n):E}}}function L(e,r){return(...t)=>{try{e(...t)}catch(n){m.useDeprecatedSynchronousErrorHandling?function(e){m.useDeprecatedSynchronousErrorHandling&&y&&(y.errorThrown=!0,y.error=e)}(n):function(e){S.setTimeout(()=>{const{onUnhandledError:r}=m;if(!r)throw e;r(e)})}(n)}}}function Q(e){throw e}function k(e,r){const{onStoppedNotification:t}=m;t&&S.setTimeout(()=>t(e,r))}const vt={closed:!0,next:E,error:Q,complete:E},St="function"==typeof Symbol&&Symbol.observable||"@@observable";function Et(e){return e}let tt=(()=>{class e{constructor(t){t&&(this._subscribe=t)}lift(t){const n=new e;return n.source=this,n.operator=t,n}subscribe(t,n,i){const s=function(e){return e&&e instanceof J||function(e){return e&&d(e.next)&&d(e.error)&&d(e.complete)}(e)&&B(e)}(t)?t:new K(t,n,i);return x(()=>{const{operator:o,source:c}=this;s.add(o?o.call(s,c):c?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(t){try{return this._subscribe(t)}catch(n){t.error(n)}}forEach(t,n){return new(n=et(n))((i,s)=>{let o;o=this.subscribe(c=>{try{t(c)}catch(u){s(u),null==o||o.unsubscribe()}},s,i)})}_subscribe(t){var n;return null===(n=this.source)||void 0===n?void 0:n.subscribe(t)}[St](){return this}pipe(...t){return function(e){return 0===e.length?Et:1===e.length?e[0]:function(t){return e.reduce((n,i)=>i(n),t)}}(t)(this)}toPromise(t){return new(t=et(t))((n,i)=>{let s;this.subscribe(o=>s=o,o=>i(o),()=>n(s))})}}return e.create=r=>new e(r),e})();function et(e){var r;return null!==(r=null!=e?e:m.Promise)&&void 0!==r?r:Promise}const At=q(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let rt=(()=>{class e extends tt{constructor(){super(),this.closed=!1,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const n=new nt(this,this);return n.operator=t,n}_throwIfClosed(){if(this.closed)throw new At}next(t){x(()=>{if(this._throwIfClosed(),!this.isStopped){const n=this.observers.slice();for(const i of n)i.next(t)}})}error(t){x(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:n}=this;for(;n.length;)n.shift().error(t)}})}complete(){x(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:n,isStopped:i,observers:s}=this;return n||i?$:(s.push(t),new p(()=>I(s,t)))}_checkFinalizedStatuses(t){const{hasError:n,thrownError:i,isStopped:s}=this;n?t.error(i):s&&t.complete()}asObservable(){const t=new tt;return t.source=this,t}}return e.create=(r,t)=>new nt(r,t),e})();class nt extends rt{constructor(r,t){super(),this.destination=r,this.source=t}next(r){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,r)}error(r){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,r)}complete(){var r,t;null===(t=null===(r=this.destination)||void 0===r?void 0:r.complete)||void 0===t||t.call(r)}_subscribe(r){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(r))&&void 0!==n?n:$}}class Mt{constructor(r,t,n){this.constants=r,this.config=t,this.subject=n}get emptyRocketMass(){return this.config.rocketWeight/1e3}get initialWaterVolume0(){return this.config.waterAmount/1e3}get initialWaterMass0(){return this.initialWaterVolume0*this.constants.rhoWater}get pressureTankVolume(){return this.config.tankVolume/1e3}get initialPressure0(){return 1e5*this.config.initialPressure}get initialAirVolume0(){return Math.max(this.pressureTankVolume-this.initialWaterVolume0,0)*Math.pow(this.initialPressure0/this.constants.pAmb,1/this.constants.gammaAir)}get initialAirMass0(){return this.initialAirVolume0*this.constants.rhoAir}get totalMass0(){return this.emptyRocketMass+this.initialWaterMass0+this.initialAirMass0}get nozzleArea(){return Math.PI*Math.pow(this.config.nozzleDiameter/1e3/2,2)}get rocketArea(){return Math.PI*Math.pow(this.config.rocketDiameter/1e3/2,2)}get currentWaterVolume(){return Math.max((this.mass-this.emptyRocketMass-this.initialAirMass0)/this.constants.rhoWater,0)}computeWaterThrust(r,t){const n=this.initialPressure0*Math.pow((this.pressureTankVolume-this.initialWaterVolume0)/(this.pressureTankVolume-this.currentWaterVolume),this.constants.gammaAir);if(n<=this.constants.pAmb)return 0;const i=Math.sqrt(2*(n-this.constants.pAmb)/this.constants.rhoWater),s=this.nozzleArea*i*this.constants.rhoWater,o=s*i;return this.mass-=s*r,t.pressure=n/1e5,t.flowVelocity=i,t.massFlowRate=s,o}computeAirThrust(r,t){const i=this.initialPressure0*Math.pow((this.pressureTankVolume-this.initialWaterVolume0)/(this.pressureTankVolume-this.currentWaterVolume+this.expelledAirMass/this.constants.rhoAir),this.constants.gammaAir);if(i<=this.constants.pAmb)return 0;const s=Math.sqrt(2*(i-this.constants.pAmb)/this.constants.rhoAir),o=this.nozzleArea*s*this.constants.rhoAir,c=o*s;return this.mass-=o*r,this.expelledAirMass+=o*r,t.pressure=i/1e5,t.flowVelocity=s,t.massFlowRate=o,c}get gravityForce(){return this.mass*this.constants.g}get dragForce(){return this.config.dragCoefficient*this.rocketArea*.5*this.constants.rhoAir*Math.pow(this.velocity,2)}init(){this.time=0,this.height=0,this.velocity=0,this.expelledAirMass=0,this.mass=this.totalMass0}tick(r){const t={time:this.time,mass:0,height:0,thrust:0,pressure:0,velocity:0,acceleration:0,flowVelocity:0,massFlowRate:0};let n=0;return this.mass>this.emptyRocketMass+this.initialAirMass0?n=this.computeWaterThrust(r,t):this.emptyRocketMass<this.mass&&this.mass<this.emptyRocketMass+this.initialAirMass0&&(n=this.computeAirThrust(r,t)),t.acceleration=(n-this.gravityForce-this.dragForce)/this.mass,this.velocity+=t.acceleration*r,this.height+=this.velocity*r,t.mass=1e3*this.mass,t.thrust=n,t.height=this.height,t.velocity=this.velocity,t}computeSteps(){const r=[];for(let n=0;n<1e5;n++){const i=this.tick(this.config.timeStep);if(this.subject.next(i),this.time+=this.config.timeStep,r.push(i),i.height<0)return r}return r}searchMaxHeight(r){let t=-1/0;return r.forEach(n=>{t=Math.max(n.height,t)}),t}execute(){this.init();const r=this.computeSteps();return{maxHeight:this.searchMaxHeight(r),duration:this.time}}}A(class{constructor(){this.subject=new rt}compute(r,t){return j(this,void 0,void 0,function*(){return new Mt(r,t,this.subject).execute()})}subscribe(r){return j(this,void 0,void 0,function*(){this.subject.subscribe(t=>j(this,void 0,void 0,function*(){r&&(yield r(t))}))})}})})();